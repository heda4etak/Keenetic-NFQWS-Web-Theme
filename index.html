<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Keenetic NFQWS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png" sizes="192x192">
    <link rel="manifest" href="manifest.json">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta name="MobileOptimized" content="320">
    <meta name="HandheldFriendly" content="true">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f172a">
    <meta name="color-scheme" content="light dark">

    <!-- CodeMirror для подсветки синтаксиса -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/fullscreen.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/fullscreen.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>

    <script defer src="tln.min.js?v=v2.10.8"></script>
    <script defer src="script.js?v=v2.10.8" type="module"></script>

    <link rel="stylesheet" href="tln.min.css?v=v2.10.8">
    <link rel="stylesheet" href="style.css?v=v2.10.8">
</head>
<body class="unknown">
<script>
    // Инициализация темы и языка
    const theme = localStorage.getItem('theme') || 'light';
    const lang = localStorage.getItem('lang') || 'en';
    
    const root = document.querySelector(':root');
    root.dataset.theme = theme;
    
    document.documentElement.lang = lang;
    
    // Сразу убираем disabled класс для предотвращения overlay
    document.body.classList.remove('disabled');
    
    // Проверяем наличие активной сессии
    const hasSession = localStorage.getItem('hasSession') === 'true';
    if (hasSession) {
        document.body.classList.add('authenticated');
    }
</script>

<header>
    <h1 class="logo">
        <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Основа щита (синяя) -->
            <path class="shield-base" d="M12 2L4 5V11C4 16.55 7.84 21.74 12 23C16.16 21.74 20 16.55 20 11V5L12 2Z" 
                  fill="none" 
                  stroke="#007AFF" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round"/>
            
            <!-- Основная трещина (красная) -->
            <path class="crack-main" d="M8 8L12 12L16 16" 
                  fill="none" 
                  stroke="#FF3B30" 
                  stroke-width="2" 
                  stroke-linecap="round"/>
            
            <!-- Вторичная трещина (красная) -->
            <path class="crack-secondary" d="M16 8L12 12L8 16" 
                  fill="none" 
                  stroke="#FF3B30" 
                  stroke-width="2" 
                  stroke-linecap="round"/>
            
            <!-- Мелкие трещины (оранжевые) -->
            <line class="small-crack crack-1" x1="10" y1="6" x2="12" y2="8" 
                  stroke="#FF9500" 
                  stroke-width="1.5" 
                  stroke-linecap="round"/>
            <line class="small-crack crack-2" x1="14" y1="6" x2="12" y2="8" 
                  stroke="#FF9500" 
                  stroke-width="1.5" 
                  stroke-linecap="round"/>
            <line class="small-crack crack-3" x1="10" y1="18" x2="12" y2="16" 
                  stroke="#FF9500" 
                  stroke-width="1.5" 
                  stroke-linecap="round"/>
            <line class="small-crack crack-4" x1="14" y1="18" x2="12" y2="16" 
                  stroke="#FF9500" 
                  stroke-width="1.5" 
                  stroke-linecap="round"/>
            
            <!-- Отколовшиеся фрагменты -->
            <circle class="fragment fragment-1" cx="7" cy="7" r="1" fill="#FF3B30" opacity="0.7"/>
            <circle class="fragment fragment-2" cx="17" cy="17" r="1" fill="#FF3B30" opacity="0.7"/>
        </svg>
        Keenetic NFQWS <span id="status"></span>
    </h1>
    <div class="header-controls">
        <!-- Кнопка Save - скрыта по умолчанию, показывается при изменении -->
        <button class="button red" id="save" style="display: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span id="save-text">Save</span>
        </button>
        
        <button class="button" id="restart">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 4v6h6"></path>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
            <span id="restart-text">Restart</span>
        </button>
        
        <!-- Dropdown меню - исправленная версия -->
        <div class="dropdown-container">
            <button class="button" id="dropdown">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
            </button>
            <ul id="dropdown-menu" class="dropdown-menu hidden">
                <li class="dropdown-item" id="reload">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"></path>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                    <span id="reload-text">Reload</span>
                </li>
                <li class="dropdown-item" id="stop">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                    <span id="stop-text">Stop</span>
                </li>
                <li class="dropdown-item" id="start">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <span id="start-text">Start</span>
                </li>
                <li class="dropdown-item" id="upgrade">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16 3 21 3 21 8"></polyline>
                        <line x1="4" y1="20" x2="21" y2="3"></line>
                        <polyline points="21 16 21 21 16 21"></polyline>
                        <line x1="15" y1="15" x2="21" y2="21"></line>
                        <line x1="4" y1="4" x2="9" y2="9"></line>
                    </svg>
                    <span id="update-text">Update</span>
                </li>
            </ul>
        </div>
    </div>
</header>

<nav></nav>

<article>
    <div class="editor-container">
        <div class="editor-toolbar">
            <span class="filename" id="current-filename">No file selected</span>
            <div class="editor-actions">
                <!-- Кнопка проверки доступности -->
                <button class="button" id="check-availability">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <span id="check-availability-text">Check Availability</span>
                </button>
                
                <button class="button" id="save-fullscreen">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    <span id="save-fs-text">Save</span>
                </button>
                <button class="icon-button" id="editor-fullscreen" title="Fullscreen">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
            </div>
        </div>
        <div class="textarea-container">
            <textarea id="config" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
        </div>
    </div>
</article>

<footer>
    <div class="footer-left">
        <a class="footer-tab" href="https://github.com/Anonym-tsk/nfqws-keenetic/" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
            GitHub
        </a>
        <a class="footer-tab" href="https://anonym-tsk.github.io/nfqws-keenetic/" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            Repository
        </a>
        <a class="footer-tab" href="https://github.com/disasdter/Keenetic-NFQWS-Theme" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M12 2v2" stroke="currentColor" stroke-width="2"/>
                <path d="M12 20v2" stroke="currentColor" stroke-width="2"/>
                <path d="M4.93 4.93l1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M17.66 17.66l1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M2 12h2" stroke="currentColor" stroke-width="2"/>
                <path d="M20 12h2" stroke="currentColor" stroke-width="2"/>
                <path d="M6.34 17.66l-1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M19.07 4.93l-1.41 1.41" stroke="currentColor" stroke-width="2"/>
            </svg>
            Theme
        </a>
    </div>
    
    <div class="footer-right">
        <!-- Language switcher -->
        <div class="language-switcher footer-tab" id="language-switcher" title="Switch language">
            <span class="language-option" data-lang="en">EN</span>
            <span class="language-separator">|</span>
            <span class="language-option" data-lang="ru">RU</span>
        </div>
        
        <!-- Theme switcher -->
        <span id="theme" class="footer-tab theme-switcher" title="Change theme">
            <svg class="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </span>
        
        <!-- Logout -->
        <span id="logout" class="footer-tab" title="Logout">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </span>
        
        <!-- Version -->
        <span id="version" class="footer-version">v2.10.8</span>
    </div>
</footer>

<div id="overlay"></div>

<div id="alert" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="popup-title"></span>
        <button class="popup-close-btn" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <pre class="popup-content" id="popup-content"></pre>
    <div class="popup-footer">
        <button class="popup-yes" id="popup-yes">Yes</button>
        <button class="popup-no" id="popup-no">No</button>
        <button class="popup-close" id="popup-close">Close</button>
    </div>
</div>

<!-- Новый попап для результатов проверки доступности -->
<div id="availability-results" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="availability-title">Проверка доступности доменов</span>
        <button class="popup-close-btn" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content" id="availability-content">
        <div class="availability-stats">
            <div class="stat-item">
                <span class="stat-label">Всего:</span>
                <span class="stat-value" id="total-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Доступны:</span>
                <span class="stat-value accessible" id="accessible-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Заблокированы:</span>
                <span class="stat-value blocked" id="blocked-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Прогресс:</span>
                <span class="stat-value" id="progress">0%</span>
            </div>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="domains-list" id="domains-list"></div>
    </div>
    <div class="popup-footer">
        <button class="popup-close" id="availability-close">Закрыть</button>
    </div>
</div>

<div id="login-form" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="login-title">Login</span>
        <button class="popup-close-btn" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content">
        <input type="text" class="login-input" id="login" autocomplete="false" autofocus placeholder="Login" />
        <input type="password" class="login-input" id="password" placeholder="Password" />
    </div>
    <div class="popup-footer">
        <button class="popup-yes" id="login-button">Login</button>
    </div>
</div>

<script>
    // JavaScript для анимации логотипа
    document.addEventListener('DOMContentLoaded', function() {
        const logo = document.querySelector('.logo-icon');
        
        // Анимация пульсации всего логотипа
        setInterval(() => {
            logo.style.transform = 'scale(1.05)';
            setTimeout(() => {
                logo.style.transform = 'scale(1)';
            }, 300);
        }, 3000);
        
        // Анимация трещин
        const cracks = document.querySelectorAll('.crack-main, .crack-secondary, .small-crack');
        cracks.forEach((crack, index) => {
            setInterval(() => {
                crack.style.strokeOpacity = '1';
                crack.style.strokeWidth = (parseFloat(crack.getAttribute('stroke-width')) + 0.5) + 'px';
                
                setTimeout(() => {
                    crack.style.strokeOpacity = '0.7';
                    crack.style.strokeWidth = crack.getAttribute('stroke-width') + 'px';
                }, 500);
            }, 2000 + index * 300);
        });
        
        // Анимация фрагментов
        const fragments = document.querySelectorAll('.fragment');
        fragments.forEach((fragment, index) => {
            setInterval(() => {
                fragment.style.opacity = '1';
                fragment.style.transform = `translate(${Math.random() * 2 - 1}px, ${Math.random() * 2 - 1}px)`;
                
                setTimeout(() => {
                    fragment.style.opacity = '0.7';
                    fragment.style.transform = 'translate(0, 0)';
                }, 800);
            }, 2500 + index * 500);
        });
    });
</script>

</body>
</html>