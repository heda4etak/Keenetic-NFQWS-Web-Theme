<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Keenetic NFQWS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png" sizes="192x192">
    <link rel="manifest" href="manifest.json">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta name="MobileOptimized" content="320">
    <meta name="HandheldFriendly" content="true">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f172a">
    <meta name="color-scheme" content="light dark">

    <!-- CodeMirror для подсветки синтаксиса -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/fullscreen.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/fullscreen.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="nfqws-syntax.js"></script>

    <script defer src="tln.min.js?v=v2.10.8"></script>
    <script defer src="script.js?v=v2.10.8" type="module"></script>

    <link rel="stylesheet" href="tln.min.css?v=v2.10.8">
    <link rel="stylesheet" href="style.css?v=v2.10.8">
</head>
<body class="unknown">
<header>
    <h1 class="logo">
        Keenetic NFQWS <span id="status"></span>
    </h1>
    <div class="header-controls">
        <!-- Кнопка Save - скрыта по умолчанию, показывается при изменении -->
        <button class="button red" id="save" style="display: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
            <span id="save-text">Save</span>
        </button>
        
        <button class="button" id="restart">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 4v6h6"></path>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
            <span id="restart-text">Restart</span>
        </button>
        
        <!-- Dropdown меню - исправленная версия -->
        <div class="dropdown-container">
            <button class="icon-button" id="dropdown">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
            </button>
            <ul id="dropdown-menu" class="dropdown-menu hidden">
                <li class="dropdown-item" id="reload">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"></path>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>
                    <span id="reload-text">Reload</span>
                </li>
                <li class="dropdown-item" id="stop">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                    <span id="stop-text">Stop</span>
                </li>
                <li class="dropdown-item" id="start">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <span id="start-text">Start</span>
                </li>
                <li class="dropdown-item" id="upgrade">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16 3 21 3 21 8"></polyline>
                        <line x1="4" y1="20" x2="21" y2="3"></line>
                        <polyline points="21 16 21 21 16 21"></polyline>
                        <line x1="15" y1="15" x2="21" y2="21"></line>
                        <line x1="4" y1="4" x2="9" y2="9"></line>
                    </svg>
                    <span id="update-text">Update</span>
                </li>
                <!-- syntax toggle moved to footer -->
            </ul>
        </div>
    </div>
</header>

<div class="nav-row">
    <nav></nav>
    <div class="nav-actions">
        <button id="add-file" type="button" class="icon-button" title="Create file">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14"/>
                <path d="M5 12h14"/>
            </svg>
        </button>
    </div>
</div>

<article>
    <div class="editor-container">
        <div class="editor-toolbar">
            <span class="filename" id="current-filename">No file selected</span>
            <div class="editor-actions">
                <button class="button list-check hidden" id="check-list">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="9" y1="6" x2="21" y2="6"></line>
                        <line x1="9" y1="12" x2="21" y2="12"></line>
                        <line x1="9" y1="18" x2="21" y2="18"></line>
                        <polyline points="3 6 4 7 6 5"></polyline>
                        <polyline points="3 12 4 13 6 11"></polyline>
                    </svg>
                    <span id="check-list-text">Check lists</span>
                </button>
                <!-- Кнопка проверки доступности -->
                <button class="button" id="check-availability">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <ellipse cx="12" cy="12" rx="4.5" ry="10"></ellipse>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                    </svg>
                    <span id="check-availability-text">Check Availability</span>
                </button>
                
                <button class="button" id="save-fullscreen">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    <span id="save-fs-text">Save</span>
                </button>
                <button class="icon-button" id="editor-fullscreen" title="Fullscreen">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </button>
            </div>
        </div>
        <div class="textarea-container">
            <textarea id="config" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
        </div>
    </div>
</article>

<footer>
    <div class="footer-left">
        <a class="footer-tab" href="https://github.com/Anonym-tsk/nfqws-keenetic/" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg>
            GitHub
        </a>
        <a class="footer-tab" href="https://anonym-tsk.github.io/nfqws-keenetic/" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            Repository
        </a>
        <a class="footer-tab" href="https://github.com/Twinkle264/Keenetic-NFQWS-Web-Theme" target="_blank">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/>
                <path d="M12 2v2" stroke="currentColor" stroke-width="2"/>
                <path d="M12 20v2" stroke="currentColor" stroke-width="2"/>
                <path d="M4.93 4.93l1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M17.66 17.66l1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M2 12h2" stroke="currentColor" stroke-width="2"/>
                <path d="M20 12h2" stroke="currentColor" stroke-width="2"/>
                <path d="M6.34 17.66l-1.41 1.41" stroke="currentColor" stroke-width="2"/>
                <path d="M19.07 4.93l-1.41 1.41" stroke="currentColor" stroke-width="2"/>
            </svg>
            Theme
        </a>
        <div class="footer-dropdown">
            <span id="tools-toggle" class="footer-tab" title="Tools">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>
                <span id="tools-label">Tools</span>
            </span>
            <ul id="tools-menu" class="dropdown-menu hidden">
                <a class="dropdown-item" href="https://hyperion-cs.github.io/dpi-checkers/ru/tcp-16-20/" target="_blank" rel="noopener">
                    DPI Checker
                </a>
                <a class="dropdown-item" href="https://github.com/whxtelxs/nfqws-zapret-converter" target="_blank" rel="noopener">
                    Zapret to NFQWS
                </a>
                <a id="router-link" class="dropdown-item" href="#" target="_blank" rel="noopener">
                    Router UI
                </a>
            </ul>
        </div>
    </div>
    
    <div class="footer-right">
        <!-- Language switcher -->
        <div class="language-switcher footer-tab" id="language-switcher" title="Switch language">
            <span class="language-option" data-lang="en">EN</span>
            <span class="language-separator">|</span>
            <span class="language-option" data-lang="ru">RU</span>
        </div>
        
        <!-- Theme switcher -->
        <span id="theme" class="footer-tab theme-switcher" title="Change theme">
            <svg class="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        </span>

        <!-- Syntax toggle -->
        <span id="syntax-toggle" class="footer-tab" title="Switch syntax highlighting">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
            <span id="syntax-text">NFQWS</span>
        </span>
        
        <!-- Logout -->
        <span id="logout" class="footer-tab" title="Logout">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </span>
        
        <!-- Version -->
        <span id="version" class="footer-version">vunknown</span>
    </div>
</footer>

<div id="overlay"></div>

<div id="alert" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="popup-title"></span>
        <button class="popup-close-btn icon-button" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <pre class="popup-content" id="popup-content"></pre>
    <div class="popup-footer">
        <button class="popup-yes" id="popup-yes">Yes</button>
        <button class="popup-no" id="popup-no">No</button>
        <button class="popup-close" id="popup-close">Close</button>
    </div>
</div>

<!-- Новый попап для результатов проверки доступности -->
<div id="availability-results" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="availability-title">Проверка доступности доменов</span>
        <button class="popup-close-btn icon-button" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content" id="availability-content">
        <div class="availability-stats duplicates-stats">
            <div class="stat-item">
                <span class="stat-label" data-label="total">Всего:</span>
                <span class="stat-value" id="total-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-label="accessible">Доступны:</span>
                <span class="stat-value accessible" id="accessible-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-label="blocked">Заблокированы:</span>
                <span class="stat-value blocked" id="blocked-domains">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-label="progress">Прогресс:</span>
                <span class="stat-value" id="progress">0%</span>
            </div>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        <div class="domains-list" id="domains-list"></div>
    </div>
    <div class="popup-footer">
        <button class="popup-close" id="availability-close">Закрыть</button>
    </div>
</div>

<div id="duplicates-results" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="duplicates-title">Check lists</span>
        <button class="popup-close-btn icon-button" id="duplicates-close-btn" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content" id="duplicates-content">
        <div class="availability-stats">
            <div class="stat-item">
                <span class="stat-label" id="duplicates-total-label">Lines:</span>
                <span class="stat-value" id="duplicates-total">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" id="duplicates-found-label">Duplicates:</span>
                <span class="stat-value blocked" id="duplicates-found">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" id="duplicates-files-label">Files:</span>
                <span class="stat-value" id="duplicates-files">0</span>
            </div>
        </div>
        <div class="duplicates-list" id="duplicates-list"></div>
    </div>
    <div class="popup-footer">
        <button class="popup-close" id="duplicates-close">Close</button>
    </div>
</div>

<div id="compare-results" class="compare-overlay hidden">
    <div class="compare-panels compare-panels-desktop">
        <div class="popup compare-panel">
            <div class="popup-header">
                <span class="filename" id="compare-left-name-desktop">current.list</span>
            </div>
            <div class="popup-content compare-content">
                <div class="textarea-container">
                    <textarea id="compare-left-content-desktop"></textarea>
                </div>
            </div>
            <div class="popup-footer compare-footer">
            </div>
        </div>
        <div class="popup compare-panel compare-panel-right">
            <div class="popup-header">
                <span class="filename" id="compare-right-name-desktop">duplicate.list</span>
            </div>
            <div class="popup-content compare-content">
                <div class="textarea-container">
                    <textarea id="compare-right-content-desktop"></textarea>
                </div>
            </div>
            <div class="popup-footer compare-footer">
                <button class="popup-yes" id="compare-save-right-desktop">Save</button>
                <button class="popup-close" id="compare-close-desktop">Close</button>
            </div>
        </div>
    </div>
    <div class="compare-panels compare-panels-mobile">
        <div class="popup compare-panel">
            <div class="popup-header">
                <div class="compare-name-switch">
                    <span class="filename compare-name active" id="compare-left-name-mobile">current.list</span>
                    <span class="filename compare-name" id="compare-right-name-mobile">duplicate.list</span>
                </div>
            </div>
            <div class="popup-content compare-content">
                <div class="textarea-container">
                    <textarea id="compare-content-mobile"></textarea>
                </div>
            </div>
            <div class="popup-footer compare-footer">
                <button class="popup-yes" id="compare-save-mobile">Save</button>
                <button class="popup-close" id="compare-close-mobile">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="login-form" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="login-title">Login</span>
        <button class="popup-close-btn icon-button" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content">
        <input type="text" class="login-input" id="login" autocomplete="false" autofocus placeholder="Login" />
        <input autocomplete="off" type="password" class="login-input" id="password" placeholder="Password" />
    </div>
    <div class="popup-footer">
        <button class="popup-yes" id="login-button">Login</button>
    </div>
</div>

<div id="create-file" class="popup hidden">
    <div class="popup-header">
        <span class="popup-title" id="create-file-title">Create file</span>
        <button class="popup-close-btn icon-button" id="create-file-close" title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="popup-content">
        <input type="text" class="login-input" id="create-file-name" placeholder="e.g. my.list" />
    </div>
    <div class="popup-footer">
        <button class="popup-yes" id="create-file-confirm">Create</button>
        <button class="popup-no" id="create-file-cancel">Cancel</button>
    </div>
</div>

</body>
</html>
